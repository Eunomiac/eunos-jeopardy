# Issue #3: Game Host Dashboard

**Status**: ğŸ”„ IN PROGRESS (70% complete - Clue management implementation in progress)
**Assignee**: Development Team
**Epic**: Game Control
**Priority**: ğŸ”´ High (Active development - clue management system)
**Last Updated**: 2025-01-15

## Description
Create host interface for game control, buzzer management, and answer adjudication. This is the central control panel where hosts manage live Jeopardy games, control the buzzer system, adjudicate player answers, and manage game flow through all rounds.

### Functional Context
A game of Euno's Jeopardy is meant to be played while all participants are in a voice chat room (e.g. Discord). Most game actions are handled verbally, with the Game Host Dashboard used to manage game flow: Players select clues, make wagers on Daily Doubles, and respond to clue prompts verbally. The dashboard provides the host with the tools needed to facilitate this voice-driven gameplay experience.

## ğŸ¯ Current Implementation Status

### âœ… **Completed Components (Phase 1)**
- **GameService** (`src/services/games/GameService.ts`) - Complete service layer
  - Game CRUD operations (create, read, update, delete)
  - Player management (join, leave, score updates)
  - Buzzer control methods (lock/unlock)
  - Answer and wager management
  - Host authorization checks throughout
- **GameCreator** (`src/components/games/GameCreator.tsx`) - Game creation interface
  - Game creation interface with clue set selection
  - Error handling and user feedback
  - Integration with existing authentication
- **GameHostDashboard** (`src/components/games/GameHostDashboard.tsx`) - UI Shell (615 lines)
  - 6-panel dashboard layout implemented
  - Basic game state display (round, status from database)
  - Player list management (when players exist)
  - Buzzer lock/unlock toggle (visual indicator only)
  - Game ending functionality (working)
- **Navigation System** - Updated App.tsx with tab-based navigation
  - "Load Clue Sets" â†’ "Host Game" â†’ "Game Dashboard" flow
  - Proper state management and component integration

### âœ… **Recent Achievements**
- **Database Issues Resolved**: All RLS policies working correctly
- **UI Foundation Complete**: 6-panel dashboard layout with authentic Jeopardy styling
- **Code Quality**: All SonarQube quality gates passing

### ğŸ”„ **Current Implementation Status**
- âœ… **Game Board**: Shows real categories and clue values from database
- âœ… **Clue Data Loading**: Complete clue set data loaded via ClueSetService
- âŒ **Clue Interaction**: Board display is not interactive (no clue selection)
- âŒ **Clue Control**: Displays static example clue text (not focused clue)
- âŒ **Buzzer Queue**: Shows placeholder "Player Name" entries (not real buzzes)
- âŒ **Control Buttons**: Most buttons are disabled or non-functional
- âŒ **Progress Tracking**: Hardcoded "17 clues left" (not real clue completion tracking)

## ğŸ¯ **Clue Management System Requirements**

### **Complete Clue Lifecycle**

The clue management system handles the complete lifecycle of each clue during gameplay, from initial loading through final adjudication. This system integrates with the Game Host Dashboard to provide seamless clue control and player interaction management.

#### **Phase 1: Clue Loading and Initialization**
**Database Integration:**
- âœ… **Clue Set Loading**: Complete clue data loaded from database via `ClueSetService.loadClueSetFromDatabase()`
- âœ… **Category Display**: Real category names displayed on game board
- âœ… **Clue Values**: Authentic Jeopardy values ($200-$1000) displayed on board
- âŒ **Clue State Initialization**: Initialize `clue_states` table entries for all clues in game
- âŒ **Daily Double Identification**: Mark Daily Double clues for special handling

**Data Structures:**
- `ClueData`: Contains prompt, response, value, position, and Daily Double status
- `ClueState`: Tracks revealed, completed, and focused status per game
- `GameState`: Tracks focused_clue_id and focused_player_id

#### **Phase 2: Clue Selection and Focus Management**
**Interactive Game Board:**
- âŒ **Clickable Clues**: Host can click any unrevealed clue on the game board
- âŒ **Visual Feedback**: Selected clue highlighted with "focused" styling
- âŒ **Focus State Management**: Track current focused clue in game state
- âŒ **Selection Validation**: Prevent selection of already completed clues
- âŒ **Focus Persistence**: Maintain focused clue across dashboard updates

**Host Controls:**
- âŒ **Clue Selection Confirmation**: Allow host to change selection before reveal
- âŒ **Focus Display**: Show focused clue details in Clue Control panel
- âŒ **Player Notification**: Highlight focused clue on player interfaces (without revealing content)

#### **Phase 3: Clue Reveal and Content Display**
**Reveal Workflow:**
- âŒ **Reveal Button**: "Reveal Prompt" button becomes active when clue is focused
- âŒ **Content Display**: Show clue prompt to all players when revealed
- âŒ **Host Response View**: Display correct response to host only
- âŒ **State Locking**: Lock clue selection once revealed (prevent accidental changes)
- âŒ **Database Updates**: Mark clue as revealed in `clue_states` table

**Daily Double Handling:**
- âŒ **Daily Double Detection**: Identify when focused clue is a Daily Double
- âŒ **Wager Input**: Show wager input field for host to enter player's verbal wager
- âŒ **Wager Validation**: Ensure wager is within valid range (minimum $5, maximum player's score or $1000)
- âŒ **Wager Storage**: Save wager to `wagers` table before revealing clue

#### **Phase 4: Buzzer System Integration**
**Buzzer Management:**
- âŒ **Buzzer Unlock**: Host unlocks buzzer after reading clue aloud
- âŒ **Buzz Detection**: Real-time detection of player buzz-ins via `buzzes` table
- âŒ **Buzz Ordering**: Display buzzes in chronological order with timing information
- âŒ **Latency Compensation**: Account for network latency in buzz timing
- âŒ **Queue Display**: Show player names and relative timing in buzzer queue

**Player Selection:**
- âŒ **Focused Player**: Host selects first player from buzz queue as focused player
- âŒ **Player Highlighting**: Highlight focused player in player list
- âŒ **Automatic Buzzer Lock**: Lock buzzer when player is selected for response
- âŒ **Queue Management**: Allow host to clear buzz queue if needed

#### **Phase 5: Answer Adjudication and Scoring**
**Adjudication Workflow:**
- âŒ **Answer Evaluation**: Host uses "Mark Correct" or "Mark Wrong" buttons
- âŒ **Score Calculation**: Calculate score change based on clue value or Daily Double wager
- âŒ **Score Updates**: Update player score in database immediately
- âŒ **Answer Recording**: Store adjudication result in `answers` table
- âŒ **Clue Completion**: Mark clue as completed in `clue_states` table

**Multiple Attempts:**
- âŒ **Incorrect Answer Handling**: Allow other players to buzz after incorrect answer
- âŒ **Buzz Queue Reset**: Clear and restart buzzer for remaining players
- âŒ **Score Penalties**: Apply negative scoring for incorrect answers
- âŒ **Final Resolution**: Complete clue when correct answer given or all players attempted

#### **Phase 6: Round Progression and Game Flow**
**Progress Tracking:**
- âŒ **Clue Completion Count**: Track number of completed clues in current round
- âŒ **Round Progress Display**: Show accurate "X clues left" and progress bar
- âŒ **Round Completion Detection**: Detect when all clues in round are completed
- âŒ **Next Round Enablement**: Enable "Next Round" button when round is complete

**State Management:**
- âŒ **Game State Persistence**: Maintain focused clue/player across page refreshes
- âŒ **Real-time Synchronization**: Update all connected clients with state changes
- âŒ **Error Recovery**: Handle network disconnections and state inconsistencies

### **Technical Implementation Requirements**

#### **Database Schema Updates**
- âŒ **Games Table**: Add `focused_clue_id` and `focused_player_id` fields
- âŒ **Clue States Table**: Add `completed` boolean field for tracking finished clues
- âŒ **Indexes**: Ensure proper indexing for game_id queries on clue_states table

#### **Service Layer Architecture**
- âŒ **ClueService**: New service for clue-specific operations
  - `selectClue(gameId, clueId, hostId)` - Set focused clue
  - `revealClue(gameId, clueId, hostId)` - Mark clue as revealed
  - `getClueState(gameId, clueId)` - Get clue state
  - `markClueCompleted(gameId, clueId, hostId)` - Mark clue finished
  - `getGameClueStates(gameId)` - Get all clue states for game

- âŒ **GameService Updates**: Enhanced game state management
  - `setFocusedClue(gameId, clueId, hostId)` - Update focused clue
  - `setFocusedPlayer(gameId, playerId, hostId)` - Update focused player
  - `adjudicateAnswer(gameId, clueId, playerId, isCorrect, hostId)` - Complete workflow

#### **Component Architecture**
- âŒ **Interactive Game Board**: Clickable clue cells with state management
- âŒ **Focused Clue Display**: Real-time display of current focused clue
- âŒ **Real Buzzer Queue**: Live display of player buzzes with timing
- âŒ **Adjudication Controls**: Functional scoring and completion buttons

- [ ] **Game Status Panel** - Display current game status and controls:
  - [ ] **Game Status** - Show current status ("Lobby", "In Progress", "Completed")
  - [ ] **Current Round** - Show current round ("Jeopardy", "Double Jeopardy", "Final Jeopardy", "Game Over")
  - [ ] **Clues Left** - Display number of clues remaining in current round
  - [ ] **Proceed to Next Round** - Button to advance rounds (disabled until current round finished)

### ğŸš€ **Phase 3: Advanced Features (Private Use Ready)**
- [ ] **Error Handling & Edge Cases**
  - [ ] **Connection Loss Recovery** - Handle player disconnections gracefully
  - [ ] **Invalid Wager Handling** - Validation for Daily Double wagers (min/max limits)
  - [ ] **Simultaneous Buzz Detection** - Clear tie-breaking rules for identical timestamps
  - [ ] **Host Mistake Recovery** - Undo functionality for incorrect adjudications

- [ ] **Desktop Usability & Accessibility**
  - [ ] **Keyboard Shortcuts** - Quick keys for common actions (spacebar for buzzer toggle, etc.)
  - [ ] **Visual Feedback** - Clear state indicators (loading, processing, error states)
  - [ ] **Audio Cues** - Optional sound effects for buzzer events (can be muted)
  - [ ] **Standard Desktop Layout** - Optimized for 1920x1080+ screens

- [ ] **Technical Implementation**
  - [ ] **Real-time Synchronization** - Ensure all players see state changes immediately
  - [ ] **Optimistic Updates** - UI responds instantly while syncing with database
  - [ ] **Conflict Resolution** - Handle race conditions in buzzer timing
  - [ ] **Performance Optimization** - Efficient updates for 10-player games

### ğŸ“± **Phase 4: Public Release Features (Future)**
- [ ] **Mobile responsiveness** - Dashboard usable on tablets/phones
- [ ] **Advanced accessibility** - Screen reader support, etc.
- [ ] **Spectator mode** - Read-only view for non-players
- [ ] **Game recording** - Optional logging for post-game analysis
- [ ] **Custom scoring rules** - Support for house rules or variations

## Acceptance Criteria

### âœ… **Phase 1: Foundation (Complete)**
- [x] **Start new game with selected clue set** - âœ… GameCreator component implemented with clue set integration
- [x] **Host authorization and security** - âœ… Complete authorization checks in GameService
- [x] **Service layer foundation** - âœ… GameService with CRUD operations for games, players, buzzes, answers, wagers
- [x] **Basic dashboard layout** - âœ… GameHostDashboard component with navigation and game state display
- [x] **Integration with existing systems** - âœ… Seamless integration with AuthContext and ClueSetSelector

### ğŸ”„ **Phase 2: Core Clue Management & Interactive Gameplay**
- [ ] **Interactive Game Board**
  - [ ] **Clue Selection** - Host can click any unrevealed clue to focus it
  - [ ] **Visual Feedback** - Selected clue highlighted with focused styling
  - [ ] **State Persistence** - Focused clue maintained across dashboard updates
  - [ ] **Completion Tracking** - Completed clues visually marked and non-selectable
  - [ ] **Daily Double Indication** - Special visual indicator for Daily Double clues

- [ ] **Focused Clue Management**
  - [ ] **Clue Display** - Show prompt and response for currently focused clue
  - [ ] **Reveal Controls** - "Reveal Prompt" button to display clue to all players
  - [ ] **Daily Double Wager** - Number input for host to enter verbal wager amount
  - [ ] **State Locking** - Prevent clue re-selection once revealed

- [ ] **Real Buzzer System**
  - [ ] **Buzzer Lock/Unlock Toggle** - Functional buzzer control integrated with clue flow
  - [ ] **Live Buzz Queue** - Display real player buzzes with names and timing
  - [ ] **Player Selection** - Host can select player from queue (makes them _Focused Player_)
  - [ ] **Latency Compensation** - Fair timing accounting for connection differences
  - [ ] **Queue Management** - Clear buzzer queue functionality

- [ ] **Answer Adjudication System**
  - [ ] **Adjudication Controls** - "Mark Correct" and "Mark Wrong" buttons
  - [ ] **Score Calculation** - Automatic score updates based on clue value or wager
  - [ ] **Answer Recording** - Store adjudication results in database
  - [ ] **Multiple Attempts** - Handle incorrect answers and allow re-buzzing
  - [ ] **Clue Completion** - Mark clues as completed after final adjudication

- [ ] **Player Management Integration**
  - [ ] **Focused Player Display** - Highlight current focused player
  - [ ] **Real-time Score Updates** - Show updated scores after adjudication
  - [ ] **Player Selection** - Select focused player from buzzer queue
  - [ ] **Score Adjustment Controls** - Manual score corrections when needed

- [ ] **Round Progression Management**
  - [ ] **Progress Tracking** - Accurate count of completed clues in current round
  - [ ] **Round Completion Detection** - Detect when all clues are completed
  - [ ] **Next Round Controls** - Enable round advancement when appropriate
  - [ ] **Game State Persistence** - Maintain state across page refreshes

### ğŸ¯ **Game Flow Control Sequence**

The following sequence describes the complete flow of control for a single clue during gameplay:

1. **Clue Selection**: The `Focused Player` verbally chooses a category and a value.

2. **Host Clue Selection**: The `Host` clicks the corresponding clue in the Board Control panel. This makes it the `Focused Clue`, and highlights it on both the Game Host Dashboard as well as the player-facing UI.

3. **Player Confirmation**: The `Focused Player` gives verbal confirmation that this is the clue they selected.

4. **Reveal Prompt**: The `Host` clicks "Reveal Prompt", which displays the clue prompt to all players.

5. **Host Reads Clue**: The `Host` reads the clue prompt aloud.

6. **Buzzer Unlock**: When the `Host` finishes reading, he unlocks the buzzer via the Buzzer Control panel, causing the buzzer to light up on the player-facing UI.

7. **Player Buzzes & Selection**: Once a player has buzzed in, the `Host` selects their name in the Buzzer Queue panel, which makes that player the `Focused Player` (and removes `Focused Player` status from the previous `Focused Player`), and automatically locks the buzzer.

8. **Response Request**: The `Host` tells the `Focused Player` to give their response verbally.

9. **Adjudication**: Once the `Focused Player` gives their response, the `Host` uses the "Mark Correct" or "Mark Wrong" buttons to adjudicate the answer and award or penalize the `Focused Player`'s score. The correct response is visible to the `Host` in the Clue Control panel but is never displayed to players - the `Host` simply states verbally whether the answer is correct.

10. **Next Clue**: After one of the "Mark ..." buttons is clicked, we return to step #1, with the `Focused Player` choosing a new clue.

### ğŸ¯ **Implementation Notes**
- **Voice-Chat Integration**: All verbal interactions (clue selection, wagers, answers) handled through Discord/voice chat
- **Desktop-First Design**: Phase 3 optimized for desktop/laptop users (1920x1080+ screens)
- **Real-time Architecture**: Supabase Realtime for immediate state synchronization across all players
- **State Management**: Focused Player and Focused Clue concepts for clean workflow management
- **Latency Compensation**: Fair buzzer timing accounting for connection speed differences

## Visual Design Reference

### Design Philosophy
Authentic Jeopardy! game show experience. Reference design images in `docs/design-images/` for visual guidance:
- **`Jeopardy Board.jpg`** - Classic game board layout
- **`Jeopardy Question.jpg`** - Clue presentation format
- **`Jeopardy Answer.jpg`** - Answer reveal styling

### Key Visual Elements

#### Color Scheme & Branding
- **Primary Blue**: Deep Jeopardy blue (#060CE9 or similar) for main backgrounds
- **Gold Accents**: Bright gold (#FFD700) for borders, highlights, and active states
- **White Text**: High contrast white text on blue backgrounds
- **Black Backgrounds**: For clue text areas and answer reveals
- **Status Colors**: Green for correct answers, red for incorrect, yellow for pending

#### Typography
- **Title**: 'Annual Normal' (SCSS: `$font-family-title`), uppercase, text shadow
- **Category Headers**: 'Swiss 921' (SCSS: `$font-family-category`), uppercase, text shadow
- **Clue Text**: 'Korinna ITC Bold' (SCSS: `$font-family-clue`), uppercase, text shadow
- **UI Text**: 'Swiss 921' (SCSS: `$font-family-ui`), standard case
- **Monetary Values**: 'Swiss 911 Extra Condensed' (SCSS: `$font-family-money`), uppercase, text shadow

#### Layout Structure
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EUNO'S JEOPARDY - HOST DASHBOARD                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Game Controls: [Lock Buzzer] [Next Round] [End Game]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚   GAME BOARD    â”‚ â”‚  PLAYER SCORES  â”‚ â”‚ BUZZER CONTROL  â”‚ â”‚
â”‚ â”‚                 â”‚ â”‚                 â”‚ â”‚                 â”‚ â”‚
â”‚ â”‚ [Category Grid] â”‚ â”‚ Player 1: $800  â”‚ â”‚ ğŸ”’ LOCKED       â”‚ â”‚
â”‚ â”‚                 â”‚ â”‚ Player 2: $600  â”‚ â”‚                 â”‚ â”‚
â”‚ â”‚ [Clue Display]  â”‚ â”‚ Player 3: $400  â”‚ â”‚ [Unlock Buzzer] â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ BUZZER QUEUE    â”‚ â”‚ ANSWER CONTROL  â”‚ â”‚  GAME STATUS    â”‚ â”‚
â”‚ â”‚                 â”‚ â”‚                 â”‚ â”‚                 â”‚ â”‚
â”‚ â”‚ 1. Player 2     â”‚ â”‚ [Mark Correct]  â”‚ â”‚ Round: Jeopardy â”‚ â”‚
â”‚ â”‚ 2. Player 1     â”‚ â”‚ [Mark Wrong]    â”‚ â”‚ Clues Left: 28  â”‚ â”‚
â”‚ â”‚ 3. Player 3     â”‚ â”‚ [Reset Buzzer]  â”‚ â”‚ Status: Active  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Technical Architecture

### Component Structure
- **GameHostDashboard** - Main container component
- **BuzzerManagementPanel** - Buzzer controls and queue display
- **PlayerManagementPanel** - Player list with scores and adjustments
- **GameBoardDisplayPanel** - Shared board component with host-specific features
- **ClueDisplayPanel** - Clue content and adjudication controls
- **GameStatusPanel** - Round progression and game state

### Data Flow
- **Real-time Updates**: Supabase Realtime for immediate state synchronization
- **Optimistic Updates**: UI responds instantly while syncing with database
- **State Management**: Focused Player/Clue concepts for clean workflow
- **Error Handling**: Comprehensive validation and recovery mechanisms

---

*This issue represents the core host experience and is critical for the MVP. Success here enables all other game features and provides the foundation for a professional game hosting experience.*