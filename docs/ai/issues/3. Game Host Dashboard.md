# Issue #3: Game Host Dashboard

**Status**: 🔄 IN PROGRESS (60% Complete)
**Assignee**: Development Team
**Epic**: Game Control
**Priority**: 🔴 High (Foundation)
**Last Updated**: 2025-09-11

## Description
Create host interface for game control, buzzer management, and answer adjudication. This is the central control panel where hosts manage live Jeopardy games, control the buzzer system, adjudicate player answers, and manage game flow through all rounds.

## 🎯 Current Implementation Status (60% Complete)

### ✅ **Completed Components**
- **GameService** (`src/services/games/GameService.ts`) - 299 lines of complete service layer
  - Game CRUD operations (create, read, update, delete)
  - Player management (join, leave, score updates)
  - Buzzer control methods (lock/unlock)
  - Answer and wager management
  - Host authorization checks throughout
- **GameCreator** (`src/components/games/GameCreator.tsx`) - 167 lines
  - Game creation interface with clue set selection
  - Error handling and user feedback
  - Integration with existing authentication
- **GameHostDashboard** (`src/components/games/GameHostDashboard.tsx`) - 250 lines
  - Basic dashboard layout and game state display
  - Player list management
  - Integration with GameService
- **Navigation System** - Updated App.tsx with tab-based navigation
  - "Load Clue Sets" → "Host Game" → "Game Dashboard" flow
  - Proper state management and component integration

### ✅ **Completed Testing**
- **GameService Tests** (`src/services/games/GameService.test.ts`) - 338 lines
  - Comprehensive test coverage for all service methods
  - Proper Supabase client mocking
  - Error handling and authorization scenarios
- **GameCreator Tests** (`src/components/games/GameCreator.test.tsx`) - 280 lines
  - Component rendering and interaction tests
  - Form validation and submission testing

### ❌ **Current Issues**
- **Test Failures**: 8 failing tests in GameCreator component
- **Coverage Gap**: 71.61% coverage (target: 90%+)
- **Database Blocker**: RLS policy needed for games table INSERT operations
- **Real-time Missing**: Supabase Realtime subscriptions not yet implemented

## Acceptance Criteria

### ✅ Completed Core Functionality
- [x] **Start new game with selected clue set** - ✅ GameCreator component implemented with clue set integration
- [x] **Host authorization and security** - ✅ Complete authorization checks in GameService
- [x] **Service layer foundation** - ✅ GameService with CRUD operations for games, players, buzzes, answers, wagers
- [x] **Basic dashboard layout** - ✅ GameHostDashboard component with navigation and game state display
- [x] **Integration with existing systems** - ✅ Seamless integration with AuthContext and ClueSetSelector

### 🔄 In Progress Core Functionality
- [ ] **Control buzzer lock/unlock** - 🔄 Service methods implemented, UI integration needed
- [ ] **View player buzzer order** - 🔄 Service methods implemented, UI components needed
- [ ] **Adjudicate answers (correct/incorrect)** - 🔄 Service methods implemented, UI components needed
- [ ] **Manage scoring and wagers** - 🔄 Service methods implemented, UI integration needed
- [ ] **Control game flow (rounds, Final Jeopardy)** - 🔄 Foundation ready, implementation needed

### ✅ Completed User Experience
- [x] **Error handling** - ✅ Comprehensive error handling in GameService and components
- [x] **Loading states** - ✅ Loading states implemented in GameCreator and GameHostDashboard
- [x] **User feedback** - ✅ Success/error messages with proper styling

### 🔄 In Progress User Experience
- [ ] **Real-time updates** - 🔄 Foundation ready, Supabase Realtime integration needed
- [ ] **Clear visual feedback** - 🔄 Basic feedback implemented, buzzer states need completion
- [ ] **Keyboard accessibility** - 🔄 Basic accessibility, keyboard shortcuts needed

### ✅ Completed Technical Requirements
- [x] **Host authorization** - ✅ Complete authorization checks throughout GameService
- [x] **Data persistence** - ✅ All game state operations implemented with proper database integration
- [x] **Service architecture** - ✅ Complete GameService with proper TypeScript types

### ❌ Outstanding Technical Requirements
- [ ] **Real-time subscriptions** - ❌ Supabase Realtime integration not yet implemented
- [ ] **Race condition handling** - ❌ Buzzer ordering logic needs real-time implementation
- [ ] **90%+ test coverage** - ❌ Currently 71.61%, 8 failing tests need fixes
- [ ] **RLS Policy** - ❌ CRITICAL: Games table INSERT policy needed

## Visual Design & User Interface

### Design Philosophy
The Game Host Dashboard should mimic the authentic Jeopardy! game show experience as closely as possible. Reference the design images in `docs/design-images/` for visual guidance:

- **`Jeopardy Board.jpg`** - Shows the classic game board layout with categories and dollar values
- **`Jeopardy Question.jpg`** - Displays how clues should be presented during gameplay
- **`Jeopardy Answer.jpg`** - Shows the answer reveal format and styling

### Visual Requirements

#### Color Scheme & Branding
- **Primary Blue**: Deep Jeopardy blue (#060CE9 or similar) for main backgrounds
- **Gold Accents**: Bright gold (#FFD700) for borders, highlights, and active states
- **White Text**: High contrast white text on blue backgrounds
- **Black Backgrounds**: For clue text areas and answer reveals
- **Status Colors**: Green for correct answers, red for incorrect, yellow for pending

#### Typography
- **Headers**: Bold, sans-serif fonts reminiscent of the game show
- **Clue Text**: Large, readable fonts for clue display
- **UI Text**: Clean, modern fonts for controls and interface elements
- **Monetary Values**: Distinctive styling for dollar amounts ($200, $400, etc.)

#### Layout Structure
```
┌─────────────────────────────────────────────────────────────┐
│ EUNO'S JEOPARDY - HOST DASHBOARD                           │
├─────────────────────────────────────────────────────────────┤
│ Game Controls: [Lock Buzzer] [Next Round] [End Game]       │
├─────────────────────────────────────────────────────────────┤
│ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ │
│ │   GAME BOARD    │ │  PLAYER SCORES  │ │ BUZZER CONTROL  │ │
│ │                 │ │                 │ │                 │ │
│ │ [Category Grid] │ │ Player 1: $800  │ │ 🔒 LOCKED       │ │
│ │                 │ │ Player 2: $600  │ │                 │ │
│ │ [Clue Display]  │ │ Player 3: $400  │ │ [Unlock Buzzer] │ │
│ └─────────────────┘ └─────────────────┘ └─────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ │
│ │ BUZZER QUEUE    │ │ ANSWER CONTROL  │ │  GAME STATUS    │ │
│ │                 │ │                 │ │                 │ │
│ │ 1. Player 2     │ │ [Mark Correct]  │ │ Round: Jeopardy │ │
│ │ 2. Player 1     │ │ [Mark Wrong]    │ │ Clues Left: 28  │ │
│ │ 3. Player 3     │ │ [Reset Buzzer]  │ │ Status: Active  │ │
│ └─────────────────┘ └─────────────────┘ └─────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

#### Component Visual Specifications

##### Game Board Display
- **Grid Layout**: 6 columns (categories) × 5 rows (dollar values)
- **Category Headers**: Gold text on blue background, bold typography
- **Clue Cells**: Blue background with gold borders, white dollar amounts
- **Selected Clue**: Highlighted with bright gold border and darker blue background
- **Completed Clues**: Dimmed or grayed out to show they've been answered
- **Daily Doubles**: Special gold star or indicator in the corner

##### Buzzer Control Panel
- **Lock State Visual**: Large, prominent indicator (🔒 LOCKED / 🔓 UNLOCKED)
- **Status Colors**: Red background when locked, green when unlocked
- **Control Button**: Large, easily clickable button to toggle state
- **Keyboard Shortcut**: Display "Press SPACE to toggle" hint
- **Animation**: Smooth transitions between lock/unlock states

##### Player List & Scores
- **Player Cards**: Individual cards for each player with name and score
- **Score Display**: Large, prominent dollar amounts with proper formatting
- **Ranking**: Visual indication of current standings (1st, 2nd, 3rd)
- **Active Player**: Highlight the player who currently has control
- **Buzzer Status**: Show who buzzed in with timestamps

##### Buzzer Queue
- **Ordered List**: Clear 1, 2, 3 numbering for buzzer order
- **Player Names**: Prominent display of who buzzed when
- **Timestamps**: Show exact buzz times for fairness
- **Clear Button**: Easy way to reset the queue
- **Visual Feedback**: Highlight the first player in queue

##### Answer Adjudication
- **Large Buttons**: Prominent "Correct" (green) and "Incorrect" (red) buttons
- **Player Context**: Show which player is being judged
- **Score Preview**: Display what the score change will be
- **Undo Option**: Allow correction of mistakes
- **Wager Display**: Show Daily Double wager amounts clearly

##### Game Flow Controls
- **Round Indicator**: Clear display of current round (Jeopardy/Double/Final)
- **Progress Tracking**: Show clues remaining, categories completed
- **Round Transition**: Smooth animations between rounds
- **Final Jeopardy**: Special UI for Final Jeopardy category and wagering

### Responsive Design
- **Primary Target**: Desktop/laptop screens (hosts typically use larger screens)
- **Minimum Width**: 1024px for optimal layout
- **Tablet Support**: Functional on tablets in landscape mode
- **Mobile**: Basic functionality maintained but not primary focus

### Accessibility Features
- **High Contrast**: Ensure all text meets WCAG AA contrast requirements
- **Keyboard Navigation**: Full keyboard control for all host functions
- **Screen Reader**: Proper ARIA labels and live regions for real-time updates
- **Focus Indicators**: Clear visual focus states for all interactive elements
- **Text Scaling**: Interface should work with browser text scaling up to 200%

### Animation & Feedback
- **Smooth Transitions**: Subtle animations for state changes
- **Button Feedback**: Clear hover and click states
- **Real-time Updates**: Smooth updates when players join/leave or scores change
- **Loading States**: Professional loading indicators for async operations
- **Success/Error**: Toast notifications or inline feedback for actions

### Game Show Authenticity
- **Professional Appearance**: Should look like it could be used on the actual TV show
- **Clean Layout**: Uncluttered, focused on essential information
- **Bold Typography**: Strong, readable fonts that work well on camera
- **Color Consistency**: Maintain the classic Jeopardy color palette throughout
- **Timing Elements**: Visual cues for time-sensitive elements (buzzer windows, etc.)

## Technical Implementation

### Database Tables
- **games**: Game sessions (host_id, clue_set_id, status, current_round, is_buzzer_locked)
- **players**: Game participants (game_id, user_id, score, nickname)
- **buzzes**: Buzzer events (game_id, clue_id, user_id, created_at)
- **answers**: Player responses (game_id, clue_id, user_id, response, is_correct, adjudicated_by)
- **wagers**: Daily Double and Final Jeopardy wagers (game_id, clue_id, user_id, amount)
- **clue_states**: Track revealed clues (game_id, clue_id, revealed)

### Component Architecture

#### Main Components
1. **GameHostDashboard** - Main container component with layout and state management
2. **GameCreator** - Interface to start new games with clue set selection
3. **BuzzerControl** - Lock/unlock buzzer with visual state and keyboard shortcuts
4. **PlayerList** - Show connected players with scores and status
5. **BuzzerQueue** - Display buzzer order for current clue with timestamps
6. **AnswerAdjudication** - Interface to mark answers correct/incorrect
7. **ScoreManager** - Handle scoring, wagers, manual adjustments
8. **GameFlowControl** - Round progression, Final Jeopardy flow
9. **GameBoard** - Display current clue set with selection capability

#### Services
1. **GameService** - CRUD operations for games, game state management
2. **BuzzerService** - Real-time buzzer management and ordering
3. **ScoringService** - Score calculations, wager handling, adjustments
4. **RealtimeGameService** - Supabase Realtime subscriptions and event handling

#### Custom Hooks
1. **useGame** - Game state management and operations
2. **useBuzzer** - Buzzer state and real-time events
3. **useRealtime** - Generic real-time subscription management

### Real-time Architecture

#### Subscription Strategy
- Subscribe to game state changes for current game
- Subscribe to buzzer events for real-time ordering
- Subscribe to player joins/leaves for participant list
- Subscribe to score changes for live leaderboard updates

#### Event Handling
- **Buzzer Events**: Handle race conditions, maintain proper ordering
- **Player Actions**: Real-time updates for joins, answers, wagers
- **Game State**: Sync round changes, buzzer lock state, game status
- **Score Updates**: Immediate reflection of scoring decisions

### Authorization & Security

#### Host Permissions
- Only game host can control buzzer lock/unlock
- Only game host can adjudicate answers
- Only game host can manage game flow and rounds
- Use existing RLS policies and `is_game_participant()` function

#### Data Validation
- Validate all user inputs before database operations
- Ensure game state consistency (can't unlock buzzer without active clue)
- Prevent duplicate buzzer events from same player
- Validate score changes and wager amounts

### Integration Points

#### Existing Systems
- **Authentication**: Use existing AuthContext for user management
- **Clue Sets**: Integrate with ClueSetSelector for game creation
- **Database**: Leverage existing Supabase client and type definitions
- **Styling**: Follow established SCSS patterns and component structure

#### App Integration
- Add navigation between "Load Clue Sets" and "Host Game" modes
- Maintain authentication state across game sessions
- Handle cleanup on logout or navigation away

## Implementation Strategy

### ✅ Phase 1: Foundation (COMPLETED)
1. ✅ Create basic GameService with CRUD operations
2. ✅ Implement GameCreator component for starting new games
3. ✅ Add game selection to main App component
4. ✅ Create basic GameHostDashboard layout and routing

### 🔄 Phase 2: Real-time Infrastructure (IN PROGRESS)
1. ❌ Implement RealtimeGameService with Supabase subscriptions
2. ❌ Create BuzzerService for real-time buzzer events
3. 🔄 Add PlayerList component with live updates (basic version implemented)
4. 🔄 Implement basic buzzer lock/unlock functionality (service methods ready)

### 🔄 Phase 3: Game Mechanics (FOUNDATION READY)
1. ❌ Create AnswerAdjudication component with scoring (service methods implemented)
2. ❌ Implement ScoringService with wager support (basic methods implemented)
3. ❌ Add BuzzerQueue for proper event ordering (service foundation ready)
4. ❌ Create ScoreManager for manual adjustments (service methods implemented)

### 🟡 Phase 4: Game Flow (PLANNED)
1. Add GameFlowControl for round progression
2. Implement Daily Double detection and wager handling
3. Create Final Jeopardy flow and scoring
4. Add game completion and results

### 🔴 Phase 5: Critical Fixes (IMMEDIATE)
1. ❌ **CRITICAL**: Fix 8 failing tests in GameCreator component
2. ❌ **CRITICAL**: Add RLS policy for games table INSERT operations
3. ❌ **HIGH**: Achieve 90%+ test coverage (currently 71.61%)
4. 🔄 Add comprehensive error handling and loading states (partially complete)
5. Implement keyboard shortcuts and accessibility features

## File Structure

### ✅ **Implemented Files**
```
src/
├── components/
│   └── games/
│       ├── GameHostDashboard.tsx          ✅ 250 lines - Basic dashboard layout
│       ├── GameCreator.tsx                ✅ 167 lines - Game creation interface
│       └── GameCreator.test.tsx           ✅ 280 lines - Component tests (8 failing)
├── services/
│   └── games/
│       ├── GameService.ts                 ✅ 299 lines - Complete service layer
│       └── GameService.test.ts            ✅ 338 lines - Comprehensive tests
└── app/
    └── App.tsx                            ✅ Updated - Tab navigation system
```

### 🔄 **Planned Files (Foundation Ready)**
```
src/
├── components/
│   └── games/
│       ├── BuzzerControl.tsx              🔄 Service methods implemented
│       ├── PlayerList.tsx                 🔄 Basic version in GameHostDashboard
│       ├── BuzzerQueue.tsx                🔄 Service methods implemented
│       ├── AnswerAdjudication.tsx         🔄 Service methods implemented
│       ├── ScoreManager.tsx               🔄 Service methods implemented
│       ├── GameFlowControl.tsx            🔄 Service methods implemented
│       └── GameBoard.tsx                  🔄 Planned
├── services/
│   └── games/
│       ├── BuzzerService.ts               🔄 Methods in GameService
│       ├── ScoringService.ts              🔄 Methods in GameService
│       └── RealtimeGameService.ts         🔄 Planned
└── hooks/
    ├── useGame.ts                         🔄 Planned
    ├── useBuzzer.ts                       🔄 Planned
    └── useRealtime.ts                     🔄 Planned
```

## Testing Strategy

### Unit Tests
- All service functions with mocked Supabase operations
- Component rendering and user interactions
- Custom hooks with various state scenarios
- Error handling and edge cases

### Integration Tests
- Real-time event handling with mocked subscriptions
- Game flow through multiple rounds
- Buzzer race conditions and ordering
- Score calculations with wagers

### E2E Scenarios
- Complete game from creation to completion
- Multiple players joining and participating
- Host controls during live gameplay
- Error recovery and reconnection

## Success Metrics

### Functional
- Host can successfully create and manage games
- Real-time buzzer system works reliably
- All game mechanics function correctly
- Players can join and participate seamlessly

### Technical
- 90%+ test coverage maintained
- All TypeScript strict mode compliance
- SonarQube quality gate passes
- Performance meets requirements (< 100ms buzzer latency)

### User Experience
- Intuitive host interface requiring minimal learning
- Clear feedback for all actions and states
- Graceful error handling and recovery
- Accessible to users with disabilities

## Dependencies

### Completed Prerequisites
- ✅ Issue #1: Simplified User Management System
- ✅ Issue #2: CSV Question Set Loader

### Parallel Development
- Can be developed alongside Issues #4-6 (Player Interface, Buzzer System, Game Board)
- Should coordinate with Issue #5 (Real-time Buzzer System) for consistent architecture

### Future Enhancements
- Integration with Issue #7 (Score Management) for advanced features
- Support for Issue #8 (Game State Management) for persistence and recovery

## Notes

### Design Considerations
- Host interface should feel like a professional game show control panel
- Clear visual hierarchy with most important controls prominent
- Real-time feedback should feel immediate and responsive
- Error states should be informative but not alarming

### Performance Considerations
- Optimize real-time subscriptions to minimize bandwidth
- Use React.memo and useMemo for expensive operations
- Batch database operations where possible
- Implement proper cleanup to prevent memory leaks

### Accessibility Requirements
- Full keyboard navigation support
- Screen reader compatibility with proper ARIA labels
- High contrast visual states
- Keyboard shortcuts for common actions (spacebar for buzzer toggle)

---

*This issue represents the core host experience and is critical for the MVP. Success here enables all other game features and provides the foundation for a professional game hosting experience.*
